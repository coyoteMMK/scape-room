<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portal de Nochebuena</title>

  <style>
    :root{
      --bg1:#0b1020; --bg2:#120a1a;
      --card:#121a33cc; --border:#ffffff1f;
      --text:#eef2ff; --muted:#b8c0ff;
      --danger:#ff5a7a; --warn:#ffd36a; --ok:#66ffcc;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius:20px;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0; min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 20% 10%, #2a1a5c 0%, transparent 60%),
        radial-gradient(700px 500px at 80% 20%, #3a0f2b 0%, transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      overflow:hidden;
    }

    /* ===== NIEVE / ESTRELLAS ===== */
    .snow{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:6; /* visible también en el final */
      filter: drop-shadow(0 0 8px rgba(255,255,255,.18));
    }
    .flake{
      position:absolute;
      top:-10vh;
      opacity:.85;
      animation-name: fall, sway;
      animation-timing-function: linear, ease-in-out;
      animation-iteration-count: infinite, infinite;
    }
    @keyframes fall { to { transform: translateY(120vh); } }
    @keyframes sway {
      0%,100% { margin-left: 0px; }
      50% { margin-left: 40px; }
    }

    .wrap{ width:min(920px,100%); position:relative; z-index:2; }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      margin-bottom:14px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border:1px solid var(--border);
      background:#0b1330b0;
      border-radius:999px;
      backdrop-filter: blur(8px);
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:999px;
      background:var(--muted);
      box-shadow:0 0 18px rgba(184,192,255,.45);
    }

    .card{
      border:1px solid var(--border);
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .hero{ padding:26px 28px 14px 28px; }
    h1{ margin:0 0 8px 0; font-size: clamp(22px, 3vw, 32px); }
    p{ margin:0; color:var(--muted); }

    .inputs{
      padding: 12px 28px 22px 28px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
    }
    .pin{
      width:58px;
      height:64px;
      border-radius:16px;
      border:1px solid var(--border);
      background:#0b1330cc;
      color:var(--text);
      font-size:28px;
      text-align:center;
    }

    .actions{
      padding: 0 28px 18px 28px;
      display:flex;
      gap:12px;
      justify-content:center;
    }
    button{
      border:none;
      padding:12px 16px;
      border-radius:14px;
      background:linear-gradient(135deg,#7c5cff,#ff4fd8);
      color:white;
      font-weight:700;
      cursor:pointer;
    }
    .ghost{
      background:transparent;
      border:1px solid var(--border);
    }

    .msg{
      min-height:24px;
      padding:0 28px 22px 28px;
      text-align:center;
    }
    .msg.error{ color:var(--danger); }
    .msg.warn{ color:var(--warn); }
    .msg.ok{ color:var(--ok); }

    /* ===== FINAL ===== */
    #finalScreen{
      display:none;
      position:fixed;
      inset:0;
      z-index:5;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(900px 500px at 20% 10%, #2a1a5c 0%, transparent 60%),
        radial-gradient(700px 500px at 80% 20%, #3a0f2b 0%, transparent 55%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
    }
    #finalCode{
      font-size: clamp(64px, 10vw, 110px);
      font-weight:950;
      letter-spacing:16px;
      opacity:0;
      animation: finalIn .9s ease forwards;
      text-shadow: 0 20px 60px rgba(0,0,0,.55);
    }
    @keyframes finalIn{ to { opacity:1; } }

    video{ display:none; }
  </style>
</head>

<body>

  <div class="snow" id="snow"></div>

  <div class="wrap" id="portalWrap">
    <div class="topbar">
      <div class="badge">
        <span class="dot" id="dot"></span>
        <span><strong>Intentos:</strong> <span id="tries">3</span></span>
      </div>
      <div class="badge">
        <strong>Portal · Nochebuena</strong>
      </div>
    </div>

    <div class="card" id="card">
      <div class="hero">
        <h1>Introduce el código de 6 dígitos</h1>
        <p>El portal solo se abrirá una vez…</p>
      </div>

      <div class="inputs">
        <input class="pin" maxlength="1" inputmode="numeric" />
        <input class="pin" maxlength="1" inputmode="numeric" />
        <input class="pin" maxlength="1" inputmode="numeric" />
        <input class="pin" maxlength="1" inputmode="numeric" />
        <input class="pin" maxlength="1" inputmode="numeric" />
        <input class="pin" maxlength="1" inputmode="numeric" />
      </div>

      <div class="actions">
        <button id="checkBtn">Abrir portal</button>
        <button class="ghost" id="clearBtn">Borrar</button>
      </div>

      <div class="msg" id="msg"></div>
    </div>
  </div>

  <div id="finalScreen">
    <div id="finalCode">591</div>
  </div>

  <video id="video">
    <source src="outro.mp4" type="video/mp4">
  </video>

  <script>
    const SECRET_6 = "220701";
    const FINAL_3  = "591";
    const MAX_TRIES = 3;

    const inputs = [...document.querySelectorAll(".pin")];
    const msg = document.getElementById("msg");
    const triesEl = document.getElementById("tries");
    const dot = document.getElementById("dot");
    const portalWrap = document.getElementById("portalWrap");
    const finalScreen = document.getElementById("finalScreen");
    const finalCode = document.getElementById("finalCode");
    const video = document.getElementById("video");

    let tries = MAX_TRIES;
    let locked = false;

    function updateTries(){
      triesEl.textContent = tries;
      dot.style.background = tries > 1 ? "#b8c0ff" : tries === 1 ? "#ffd36a" : "#ff5a7a";
    }

    function getCode(){ return inputs.map(i => i.value).join(""); }

    function clearAll(){
      inputs.forEach(i => i.value = "");
      inputs[0].focus();
    }

    async function playVideo(){
      video.style.display = "block";
      video.currentTime = 0;
      try{
        if(video.requestFullscreen) await video.requestFullscreen();
      }catch(e){}
      await video.play();

      video.onended = () => {
        if(document.fullscreenElement) document.exitFullscreen();
        video.style.display = "none";
        portalWrap.style.display = "none";
        finalCode.textContent = FINAL_3;
        finalScreen.style.display = "flex";
      };
    }

    function fail(){
      tries--;
      updateTries();
      if(tries <= 0){
        msg.textContent = "PORTAL BLOQUEADO";
        msg.className = "msg error";
        inputs.forEach(i => i.disabled = true);
        locked = true;
        return;
      }
      msg.textContent = tries === 1 ? "Último intento…" : "Código incorrecto";
      msg.className = tries === 1 ? "msg warn" : "msg error";
      clearAll();
    }

    document.getElementById("checkBtn").onclick = async () => {
      if(locked) return;
      if(getCode().length < 6){
        msg.textContent = "Completa los 6 dígitos";
        msg.className = "msg error";
        return;
      }
      if(getCode() === SECRET_6){
        msg.textContent = "Acceso concedido";
        msg.className = "msg ok";
        await playVideo();
      }else{
        fail();
      }
    };

    document.getElementById("clearBtn").onclick = clearAll;

    inputs.forEach((input,i)=>{
      input.oninput = () => {
        input.value = input.value.replace(/\D/g,"");
        if(input.value && i < inputs.length-1) inputs[i+1].focus();
      };
    });

    // generar nieve
    (function(){
      const snow = document.getElementById("snow");
      const symbols = ["❄","✦","✧","❅","✴"];
      for(let i=0;i<26;i++){
        const f = document.createElement("div");
        f.className = "flake";
        f.textContent = symbols[Math.floor(Math.random()*symbols.length)];
        f.style.left = Math.random()*100 + "vw";
        f.style.fontSize = 12 + Math.random()*18 + "px";
        f.style.animationDuration = (8 + Math.random()*10) + "s";
        f.style.animationDelay = (-Math.random()*10) + "s";
        snow.appendChild(f);
      }
    })();

    updateTries();
    inputs[0].focus();
  </script>
</body>
</html>
